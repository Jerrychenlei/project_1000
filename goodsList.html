<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<title></title>
	<meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" name="viewport" />
	<meta content="yes" name="apple-mobile-web-app-capable" />
	<meta content="black" name="apple-mobile-web-app-status-bar-style" />
	<meta content="telephone=no" name="format-detection" />
	<link rel="stylesheet" href="./lib/iconfont/iconfont.css">
	<link rel="stylesheet" href="./lib/vant/index.css">
	<link href="css/goodsList.css" rel="stylesheet" type="text/css" />
</head>

<body>
	<section class="aui-flexView">
		<section class="aui-scrollView">
			<div class="aui-shop-change">
				<div class="aui-search-box">
					<i class="icon icon-search"></i>
					<input type="text" placeholder="搜索商品" id="sosoHtml">
				</div>
			</div>
			<div class="aui-list-theme-box" id="getGoodsList">
				<!-- <a href="javascript:;" class="aui-list-item">
					<div class="aui-list-theme-img">
						<img src="img/pd-013.png" alt="">
					</div>
					<div class="aui-list-theme-message">
						<h3 class="aui-list-theme-title">智能陪护让你的孩子赢在起跑线上面</h3>
						<h3 class="aui-list-theme-subtitle">预售商品 限时抽取三名幸运奖</h3>
						<div class="aui-flex">
							<div class="aui-flex-box">
								<h2><em>￥</em>648 <i>￥899</i></h2>
							</div>
							<div class="aui-coupon"><span class="iconfont icon-gouwuche"></span></div>
						</div>
					</div>
				</a>
				<a href="javascript:;" class="aui-list-item">
					<div class="aui-list-theme-img">
						<img src="img/pd-014.png" alt="">
					</div>
					<div class="aui-list-theme-message">
						<h3 class="aui-list-theme-title">智能陪护让你的孩子赢在起跑线上面</h3>
						<h3 class="aui-list-theme-subtitle">预售商品 限时抽取三名幸运奖</h3>
						<div class="aui-flex">
							<div class="aui-flex-box">
								<h2><em>￥</em>648 <i>￥899</i></h2>
							</div>
							<div class="aui-coupon"><span class="iconfont icon-gouwuche"></span></div>
						</div>
					</div>
				</a>
				<a href="javascript:;" class="aui-list-item">
					<div class="aui-list-theme-img">
						<img src="img/pd-015.png" alt="">
					</div>
					<div class="aui-list-theme-message">
						<h3 class="aui-list-theme-title">智能陪护让你的孩子赢在起跑线上面</h3>
						<h3 class="aui-list-theme-subtitle">预售商品 限时抽取三名幸运奖</h3>
						<div class="aui-flex">
							<div class="aui-flex-box">
								<h2><em>￥</em>648 <i>￥899</i></h2>
							</div>
							<div class="aui-coupon"><span class="iconfont icon-gouwuche"></span></div>
						</div>
					</div>
				</a>
				<a href="javascript:;" class="aui-list-item">
					<div class="aui-list-theme-img">
						<img src="img/pd-016.png" alt="">
					</div>
					<div class="aui-list-theme-message">
						<h3 class="aui-list-theme-title">智能陪护让你的孩子赢在起跑线上面</h3>
						<h3 class="aui-list-theme-subtitle">预售商品 限时抽取三名幸运奖</h3>
						<div class="aui-flex">
							<div class="aui-flex-box">
								<h2><em>￥</em>648 <i>￥899</i></h2>
							</div>
							<div class="aui-coupon"><span class="iconfont icon-gouwuche"></span></div>
						</div>
					</div>
				</a>
				<a href="javascript:;" class="aui-list-item">
					<div class="aui-list-theme-img">
						<img src="img/pd-015.png" alt="">
					</div>
					<div class="aui-list-theme-message">
						<h3 class="aui-list-theme-title">智能陪护让你的孩子赢在起跑线上面</h3>
						<h3 class="aui-list-theme-subtitle">预售商品 限时抽取三名幸运奖</h3>
						<div class="aui-flex">
							<div class="aui-flex-box">
								<h2><em>￥</em>648 <i>￥899</i></h2>
							</div>
							<div class="aui-coupon"><span class="iconfont icon-gouwuche"></span></div>
						</div>
					</div>
				</a>
				<a href="javascript:;" class="aui-list-item">
					<div class="aui-list-theme-img">
						<img src="img/pd-016.png" alt="">
					</div>
					<div class="aui-list-theme-message">
						<h3 class="aui-list-theme-title">智能陪护让你的孩子赢在起跑线上面</h3>
						<h3 class="aui-list-theme-subtitle">预售商品 限时抽取三名幸运奖</h3>
						<div class="aui-flex">
							<div class="aui-flex-box">
								<h2><em>￥</em>648 <i>￥899</i></h2>
							</div>
							<div class="aui-coupon"><span class="iconfont icon-gouwuche"></span></div>
						</div>
					</div>
				</a> -->
			</div>
			<div class="aui-pagination">
				<div class="aui-pagination-prev disabled">
					<i class="van-icon van-icon-arrow-left"></i>
				</div>
				<div class="aui-pagination-page">
					1/5,共30件商品
				</div>
				<div class="aui-pagination-next">
					<i class="van-icon van-icon-arrow"></i>
				</div>
			</div>
		</section>
	</section>
	<div class="van-hairline--top-bottom van-tabbar van-tabbar--fixed">
		<div class="van-tabbar-item van-tabbar-item--active">
			<div class="van-tabbar-item__icon">
				<i class="van-icon van-icon-wap-home-o"></i>
			</div>
			<div class="van-tabbar-item__text">商品</div>
		</div>
		<div class="van-tabbar-item">
			<div class="van-tabbar-item__icon">
				<i class="van-icon van-icon-shopping-cart-o"></i>
			</div>
			<div class="van-tabbar-item__text">购物车</div>
		</div>
	</div>
</body>
<script src="./lib/jquery.min.js"></script>
<script src="./lib/template-web.js"></script>
<!-- 模板引擎 -->
<script type="text/html" id="tpl-GoodsList">
{{each data}}
<a href="javascript:;" class="aui-list-item" >
	<div class="aui-list-theme-img" data-id="{{$value.id}}">
		<img src="{{$value.fileurl | imgUrl}}" alt="" >
	</div>
	<div class="aui-list-theme-message">
		<h3 class="aui-list-theme-title">{{$value.name}}</h3>
		<h3 class="aui-list-theme-subtitle">{{$value.content}}</h3>
		<div class="aui-flex">
			<div class="aui-flex-box" >
				<h2><em>￥</em>{{$value.price}} <i>￥899</i></h2>
			</div>
			<div class="aui-coupon" data-index="{{$value.id}}" data-monney="{{$value.price}}"><span class="iconfont icon-gouwuche"></span></div>
		</div>
	</div>
</a>
{{/each}}
</script>

<script>
	// 页码变量
	let pageNum = 1;
	// 
	let ele = null;
	$(() => {

		// 模板引擎过滤器
		template.defaults.imports.imgUrl = function (fileurl) {
			return 'http://www.shop.com' + fileurl;
		}

		// 调用获取商品列表函数
		setData();
		// 下一页点击事件
		$('.aui-pagination-next').on('click', bottomPage);
		// 上一页点击事件
		$('.aui-pagination-prev').on('click', topPage);

		// 搜索框鼠标移入事件
		// $('#sosoHtml').on('blur', getSoso);
		// 事件委托
		$('#getGoodsList').on('click', '.aui-list-theme-img', getGoodsInfo);
		// 商品添加购物车按钮点击事件
		$('#getGoodsList').on('click', '.aui-coupon', addCart)
		// 底部跳转购物车按钮点击事件
		$('.van-tabbar-item__text').on('click', getCart);
	})
	// 获取商品列表--分页功能--事件函数---
	function setData(page, search) {
		$('.aui-pagination-next')
		$.ajax({
			method: 'GET',
			url: 'http://www.shop.com/api/goods/getList',
			data: {
				page: page,
				search: search
			},
			success(res) {
				ele = res
				getHtmlData(res);
			}
		})
	}
	// 渲染页面功能---------
	function getHtmlData(res) {
		let strHtml = template('tpl-GoodsList', res);
		$('#getGoodsList').empty().html(strHtml);
		$('.aui-pagination-page').html(`${pageNum}/${res.page.pageCount}`)

	}
	// 下一页--事件函数----
	function bottomPage() {
		if (pageNum == ele.page.pageCount) {
			return alert('最后一页')
		}
		pageNum++;
		setData(pageNum, '');
	}
	// 上一页--事件函数-----
	function topPage() {
		if (pageNum == 1) {
			return alert('第一页')
		}
		pageNum--;
		setData(pageNum, '');
	}
	// 搜索框功能--事件函数----
	// function getSoso() {
	// 	let strText = $('#sosoHtml').val();
	// 	console.log(strText);
	// }
	// 跳转商品详情页面
	function getGoodsInfo() {
		let index = this.getAttribute('data-id');
		console.log(index);
		location = './goodsInfo.html' + '?' + 'id=' + index;
	}
	// 添加购物车功能
	function addCart() {
		// 获取用户token值
		let myToken = localStorage.getItem('token');
		// 获取商品id
		let index = this.getAttribute('data-index');
		// 获取商品价格
		let monney = this.getAttribute('data-monney');
		$.ajax({
			method: 'GET',
			url: 'http://www.shop.com/api/cart/add',
			data: {
				gid: index,
				price: monney,
				token: myToken
			},
			success(res) {
				console.log(res);
			}
		})
	}
	// 跳转购物车页面--事件函数----
	function getCart() {
		location = './cart.html'
	}
</script>

</html>